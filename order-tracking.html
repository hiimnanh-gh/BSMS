<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Theo dÃµi Ä‘Æ¡n hÃ ng | Bookstore</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">

  <div class="max-w-4xl mx-auto p-6 mt-8 bg-white rounded shadow">
    <h1 class="text-3xl font-bold mb-6">ğŸ“¦ Theo dÃµi Ä‘Æ¡n hÃ ng</h1>

    <!-- ThÃ´ng tin Ä‘Æ¡n hÃ ng -->
    <div id="order-info" class="space-y-4 mb-6 text-gray-700 text-base"></div>

    <!-- Tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng -->
    <div class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng:</h2>
      <p class="text-center text-gray-700 font-medium mb-2" id="current-status-text"></p>
      <div class="relative pt-1">
        <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-green-200">
          <div id="progress-bar" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-600 w-1/3"></div>
        </div>
        <div class="flex justify-between text-sm text-gray-600">
          <span>Äang xá»­ lÃ½</span>
          <span>Äang giao</span>
          <span>ÄÃ£ giao</span>
        </div>
      </div>
    </div>

    <!-- Animation shipper -->
    <div class="flex justify-center my-8">
      <lottie-player
        src="https://lottie.host/597688cf-8f3e-42bc-8fae-cb12217e91c0/ET7HDJZfIN.json"
        background="transparent"
        speed="1"
        style="width: 300px; height: 300px;"
        loop
        autoplay>
      </lottie-player>
    </div>

    <!-- NÃºt cáº­p nháº­t tráº¡ng thÃ¡i -->
    <div class="text-right">
      <button id="update-btn" onclick="nextStatus()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded">
        Cáº­p nháº­t tráº¡ng thÃ¡i
      </button>
    </div>
  </div>

  <script>
    const order = JSON.parse(localStorage.getItem("currentOrder") || "null");

    if (!order) {
      document.getElementById("order-info").innerHTML = `<p class="text-red-500">KhÃ´ng tÃ¬m tháº¥y Ä‘Æ¡n hÃ ng.</p>`;
    } else {
      const container = document.getElementById("order-info");
      const items = order.items.map(item => {
        const qty = item.qty || 1;
        return `<li>${item.title} Ã— ${qty}</li>`;
      }).join("");

      container.innerHTML = `
        <p><strong>ğŸ‘¤ KhÃ¡ch hÃ ng:</strong> ${order.customer.name}</p>
        <p><strong>ğŸ“ SÄT:</strong> ${order.customer.phone}</p>
        <p><strong>ğŸ  Äá»‹a chá»‰:</strong> ${order.customer.address}</p>
        <p><strong>ğŸ’³ Thanh toÃ¡n:</strong> ${order.payment.toUpperCase()}</p>
        <p><strong>ğŸ’° Tá»•ng tiá»n:</strong> ${order.total}</p>
        <p><strong>ğŸ“š SÃ¡ch:</strong></p>
        <ul class="list-disc list-inside text-gray-700">${items}</ul>
      `;
    }

    const statusList = ["Äang xá»­ lÃ½", "Äang giao", "ÄÃ£ giao"];
    let statusIndex = order ? statusList.indexOf(order.status || "Äang xá»­ lÃ½") : 0;

    function updateProgress() {
      const bar = document.getElementById("progress-bar");
      const statusText = document.getElementById("current-status-text");
      const updateBtn = document.getElementById("update-btn");

      const percent = ["w-1/3", "w-2/3", "w-full"];
      bar.className = `shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-600 ${percent[statusIndex]}`;
      statusText.textContent = `ğŸ“¦ Tráº¡ng thÃ¡i: ${statusList[statusIndex]}`;

      if (statusIndex === 2 && updateBtn) {
        updateBtn.disabled = true;
        updateBtn.classList.add("opacity-50", "cursor-not-allowed");
        updateBtn.textContent = "ÄÃ£ giao xong";
      }
    }

    function nextStatus() {
      if (statusIndex < 2) {
        statusIndex++;
        order.status = statusList[statusIndex];
        localStorage.setItem("currentOrder", JSON.stringify(order));
        updateProgress();
      } else {
        alert("âœ… ÄÆ¡n hÃ ng Ä‘Ã£ Ä‘Æ°á»£c giao thÃ nh cÃ´ng!");
      }
    }

    updateProgress();
  </script>
</body>
</html>
